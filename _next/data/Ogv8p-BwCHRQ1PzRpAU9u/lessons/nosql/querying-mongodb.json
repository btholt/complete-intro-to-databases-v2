{"pageProps":{"post":{"attributes":{"description":"After inserting documents into MongoDB, you are going to want to be able to query those documents. Brian shows you how in this section to write find queries for MongoDB."},"html":"<p>So now that we&#39;ve put a lot of documents into our database, it&#39;s time to query our database to get information out of it. There are a variety of reasons and methods you can query a database. You could be querying a database to get one a specific record, like if you&#39;re querying for a user object to show a profile page, or you could be querying for a bunch of things at once, like if a user was searching for pets and you wanted to show five results.</p>\n<h2>findOne</h2>\n<p>Let&#39;s start with basic querying. Run this in the console.</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">findOne</span>();\n</code></pre><p>This will go out and find the first item in the database that matches your query and return that. In this case we didn&#39;t give it a query which is the same as saying &quot;give me anything.&quot; You&#39;ll probably get back the first item you inserted into your database which in my case is going to be a Havanese dog named Luna.</p>\n<p>Okay, so let&#39;s we want to find the 1337 item we put in the database. Try this:</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">findOne</span>({ <span class=\"hljs-attr\">index</span>: <span class=\"hljs-number\">1337</span> });\n</code></pre><p>This will find you one item (of which there is only one anyway) where the index is equal to 1337. Okay, one more, let&#39;s find one where it&#39;s a dog named Spot.</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">findOne</span>({ <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Spot&quot;</span>, <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> });\n</code></pre><h2>find</h2>\n<p>So far we&#39;ve only been looking at finding one record at time. If you want to find all documents that match your query, you&#39;ll have to use find instead of findOne. Let&#39;s try it.</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> });\n</code></pre><p>Notice this only giving you twenty results. What MongoDB does by default is only hand you twenty results at a time in the form of what&#39;s called an <strong>iterator</strong> or a <strong>cursor</strong>. An iterator will give you twenty records at a time and allow you to iterate over your results. Frequently this is a useful pattern because you could in theory want to iterate over your whole collection and this allows you to do it piece by piece.</p>\n<p>Try iterating now. Run this:</p>\n<pre><code>it\nit\nit\n</code></pre><p>You&#39;ll notice that you&#39;re getting twenty different records each time. <code>it</code> will tell your iterator that you want it to iterate again on the last iterator you queried for.</p>\n<h2>count, limit, and toArray</h2>\n<p>Okay, so let&#39;s try this:</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">count</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }); <span class=\"hljs-comment\">// probably pretty big number</span>\ndb.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }).<span class=\"hljs-title function_\">limit</span>(<span class=\"hljs-number\">40</span>);\nit; <span class=\"hljs-comment\">// after this the cursor will end</span>\n</code></pre><p><code>count</code> lets you figure our how many of something there are. <code>limit</code> lets the cursor know when you want to stop. But what if you just want to get everything all at once? Try <code>toArray</code></p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }).<span class=\"hljs-title function_\">limit</span>(<span class=\"hljs-number\">40</span>).<span class=\"hljs-title function_\">toArray</span>();\n</code></pre><p>This will just dump everything out into an array which is nice if you just want everything all at once. There&#39;s a myriad of other things you can do that determine how the data is returned but you can find those fairly easily when you need them.</p>\n<h2>Query operators</h2>\n<p>What if we wanted to find all senior-aged cats in our data set? MongoDB will let you do that! Let&#39;s try this</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">count</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;cat&quot;</span>, <span class=\"hljs-attr\">age</span>: { <span class=\"hljs-attr\">$gt</span>: <span class=\"hljs-number\">12</span> } });\n</code></pre><p>Note you can use these <a href=\"%5Bgeo%5D:\">query operators</a> anywhere you&#39;re providing a query e.g. findOne, find, etc. The ones you&#39;re primarily going to be interested in are</p>\n<ul>\n<li>$gt - greater than</li>\n<li>$gte - greater than or equal to</li>\n<li>$lt - less than</li>\n<li>$lte - less than or equal to</li>\n<li>$eq - equals (usually not necessary)</li>\n<li>$ne - not equals</li>\n<li>$in - has the value in the array (MongoDB can store arrays and objects too!)</li>\n<li>$nin - does not have the value in the array</li>\n</ul>\n<p>If you wanted to see all Fidos that are not dogs you could do:</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({\n  <span class=\"hljs-attr\">type</span>: { <span class=\"hljs-attr\">$ne</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> },\n  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Fido&quot;</span>,\n});\n</code></pre><h2>Logical operators</h2>\n<p>Taking it a step further, you can do logical operators as well. Let&#39;s say you want to find birds between 4 and 8 years old</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({\n  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;bird&quot;</span>,\n  <span class=\"hljs-attr\">$and</span>: [{ <span class=\"hljs-attr\">age</span>: { <span class=\"hljs-attr\">$gte</span>: <span class=\"hljs-number\">4</span> } }, { <span class=\"hljs-attr\">age</span>: { <span class=\"hljs-attr\">$lte</span>: <span class=\"hljs-number\">8</span> } }],\n});\n</code></pre><p>You also have $or, $nor, and $not available to you. Keep in mind that $not and $ne are different. The former is the logical operator and the latter is <code>!==</code>.</p>\n<h2>Special operators</h2>\n<p>These won&#39;t be useful now but I just wanted to let you know that you can query by type (see if something is a number, array, object, etc.) with $type and you can query if a document has a field or not with $exists.</p>\n<p>There&#39;s a bunch more you can do too. MongoDB even has [geospatial operators][geo] so you can query if two points on the globe are close to each other!</p>\n<h2>Sorts</h2>\n<p>Frequently you&#39;ll need to do different sorts with your queries. Let&#39;s say you&#39;re making a search page for these pets (foreshadowing what we&#39;re about to do!) Maybe the person who searching on your website is a kind soul and looking to adopt some senior dogs. They could say sort by age, descending.</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }).<span class=\"hljs-title function_\">sort</span>({ <span class=\"hljs-attr\">age</span>: -<span class=\"hljs-number\">1</span> });\n</code></pre><p>The <code>-1</code> means descending and, as you probably guessed, 1 means ascending.</p>\n<h2>Projections</h2>\n<p>Lastly, to conclude our little lesson querying (there&#39;s still a lot more you can do), let&#39;s talk about projections. The simplest way to use projections is just to limit which fields you return.</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }, { <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">breed</span>: <span class=\"hljs-number\">1</span> });\n</code></pre><p>The <code>1</code> means &quot;definitely include this&quot;. In thise case, we&#39;re only including name and breed. If you leave something out (like age) then it doesn&#39;t come along for the ride. Notice that <code>_id</code> does come along. If you don&#39;t want that, you have to explictly exclude it</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }, { <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">breed</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span> });\ndb.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }, { <span class=\"hljs-attr\">name</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-attr\">breed</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-literal\">false</span> }); <span class=\"hljs-comment\">// note that true and false work too</span>\n</code></pre><p>It also works to just exclude fields which means include everything I haven&#39;t excluded</p>\n<pre><code class=\"hljs language-javascript\">db.<span class=\"hljs-property\">pets</span>.<span class=\"hljs-title function_\">find</span>({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;dog&quot;</span> }, { <span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span> });\n</code></pre>","markdown":"\nSo now that we've put a lot of documents into our database, it's time to query our database to get information out of it. There are a variety of reasons and methods you can query a database. You could be querying a database to get one a specific record, like if you're querying for a user object to show a profile page, or you could be querying for a bunch of things at once, like if a user was searching for pets and you wanted to show five results.\n\n## findOne\n\nLet's start with basic querying. Run this in the console.\n\n```javascript\ndb.pets.findOne();\n```\n\nThis will go out and find the first item in the database that matches your query and return that. In this case we didn't give it a query which is the same as saying \"give me anything.\" You'll probably get back the first item you inserted into your database which in my case is going to be a Havanese dog named Luna.\n\nOkay, so let's we want to find the 1337 item we put in the database. Try this:\n\n```javascript\ndb.pets.findOne({ index: 1337 });\n```\n\nThis will find you one item (of which there is only one anyway) where the index is equal to 1337. Okay, one more, let's find one where it's a dog named Spot.\n\n```javascript\ndb.pets.findOne({ name: \"Spot\", type: \"dog\" });\n```\n\n## find\n\nSo far we've only been looking at finding one record at time. If you want to find all documents that match your query, you'll have to use find instead of findOne. Let's try it.\n\n```javascript\ndb.pets.find({ type: \"dog\" });\n```\n\nNotice this only giving you twenty results. What MongoDB does by default is only hand you twenty results at a time in the form of what's called an **iterator** or a **cursor**. An iterator will give you twenty records at a time and allow you to iterate over your results. Frequently this is a useful pattern because you could in theory want to iterate over your whole collection and this allows you to do it piece by piece.\n\nTry iterating now. Run this:\n\n```\nit\nit\nit\n```\n\nYou'll notice that you're getting twenty different records each time. `it` will tell your iterator that you want it to iterate again on the last iterator you queried for.\n\n## count, limit, and toArray\n\nOkay, so let's try this:\n\n```javascript\ndb.pets.count({ type: \"dog\" }); // probably pretty big number\ndb.pets.find({ type: \"dog\" }).limit(40);\nit; // after this the cursor will end\n```\n\n`count` lets you figure our how many of something there are. `limit` lets the cursor know when you want to stop. But what if you just want to get everything all at once? Try `toArray`\n\n```javascript\ndb.pets.find({ type: \"dog\" }).limit(40).toArray();\n```\n\nThis will just dump everything out into an array which is nice if you just want everything all at once. There's a myriad of other things you can do that determine how the data is returned but you can find those fairly easily when you need them.\n\n## Query operators\n\nWhat if we wanted to find all senior-aged cats in our data set? MongoDB will let you do that! Let's try this\n\n```javascript\ndb.pets.count({ type: \"cat\", age: { $gt: 12 } });\n```\n\nNote you can use these [query operators][operators] anywhere you're providing a query e.g. findOne, find, etc. The ones you're primarily going to be interested in are\n\n- \\$gt - greater than\n- \\$gte - greater than or equal to\n- \\$lt - less than\n- \\$lte - less than or equal to\n- \\$eq - equals (usually not necessary)\n- \\$ne - not equals\n- \\$in - has the value in the array (MongoDB can store arrays and objects too!)\n- \\$nin - does not have the value in the array\n\nIf you wanted to see all Fidos that are not dogs you could do:\n\n```javascript\ndb.pets.find({\n  type: { $ne: \"dog\" },\n  name: \"Fido\",\n});\n```\n\n## Logical operators\n\nTaking it a step further, you can do logical operators as well. Let's say you want to find birds between 4 and 8 years old\n\n```javascript\ndb.pets.find({\n  type: \"bird\",\n  $and: [{ age: { $gte: 4 } }, { age: { $lte: 8 } }],\n});\n```\n\nYou also have $or, $nor, and \\$not available to you. Keep in mind that $not and $ne are different. The former is the logical operator and the latter is `!==`.\n\n## Special operators\n\nThese won't be useful now but I just wanted to let you know that you can query by type (see if something is a number, array, object, etc.) with $type and you can query if a document has a field or not with $exists.\n\nThere's a bunch more you can do too. MongoDB even has [geospatial operators][geo] so you can query if two points on the globe are close to each other!\n\n## Sorts\n\nFrequently you'll need to do different sorts with your queries. Let's say you're making a search page for these pets (foreshadowing what we're about to do!) Maybe the person who searching on your website is a kind soul and looking to adopt some senior dogs. They could say sort by age, descending.\n\n```javascript\ndb.pets.find({ type: \"dog\" }).sort({ age: -1 });\n```\n\nThe `-1` means descending and, as you probably guessed, 1 means ascending.\n\n## Projections\n\nLastly, to conclude our little lesson querying (there's still a lot more you can do), let's talk about projections. The simplest way to use projections is just to limit which fields you return.\n\n```javascript\ndb.pets.find({ type: \"dog\" }, { name: 1, breed: 1 });\n```\n\nThe `1` means \"definitely include this\". In thise case, we're only including name and breed. If you leave something out (like age) then it doesn't come along for the ride. Notice that `_id` does come along. If you don't want that, you have to explictly exclude it\n\n```javascript\ndb.pets.find({ type: \"dog\" }, { name: 1, breed: 1, _id: 0 });\ndb.pets.find({ type: \"dog\" }, { name: true, breed: true, _id: false }); // note that true and false work too\n```\n\nIt also works to just exclude fields which means include everything I haven't excluded\n\n```javascript\ndb.pets.find({ type: \"dog\" }, { _id: 0 });\n```\n\n[operators]:\n[geo]:\n","slug":"querying-mongodb","title":"Querying Mongodb","section":"Nosql","icon":"info-circle","filePath":"/home/runner/work/complete-intro-to-databases-v2/complete-intro-to-databases-v2/lessons/02-nosql/C-querying-mongodb.md","nextSlug":"/lessons/nosql/updating-mongodb","prevSlug":"/lessons/nosql/mongodb"}},"__N_SSG":true}