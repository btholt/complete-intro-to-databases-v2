<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Updating Mongodb – Complete Intro to Databases v2</title><meta name="description" content="Brian shows you how to update and delete the documents that have been inserted into the database." data-next-head=""/><meta name="keywords" content="postgres,sql,redis,mongodb,neo4j,database,data,agents" data-next-head=""/><meta name="og:description" content="Brian shows you how to update and delete the documents that have been inserted into the database." data-next-head=""/><meta name="og:title" content="Updating Mongodb – Complete Intro to Databases v2" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/chunks/3802a39ca373f962.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/3802a39ca373f962.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/dbe15a90055bd265.js" defer=""></script><script src="/_next/static/chunks/49c75c2ed6206f46.js" defer=""></script><script src="/_next/static/chunks/da0ff8adaa6cce90.js" defer=""></script><script src="/_next/static/chunks/turbopack-342361b32f83e6b6.js" defer=""></script><script src="/_next/static/chunks/f189af6b04c7fd39.js" defer=""></script><script src="/_next/static/chunks/turbopack-8b35dea75ba6f85c.js" defer=""></script><script src="/_next/static/Ogv8p-BwCHRQ1PzRpAU9u/_ssgManifest.js" defer=""></script><script src="/_next/static/Ogv8p-BwCHRQ1PzRpAU9u/_buildManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><div id="__next"><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet"/><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Databases v2</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/databases-v2/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><h2>insert, insertOne, and insertMany</h2>
<p>You already encountered insert at the beginning of this section but I just wanted to disambiguate insertOne and insertMany for you. insert essentially does the job of both insertMany and insertOne: if you give it an array it will insert many and if you give it an object it will insert one. The insertOne and insertMany methods are nice because if you accidentally give it the wrong thing (like giving it an object when you meant to give it an array) it will cause an error and make you fix it. With insert, you have a higher chance of it doing the wrong thing.</p>
<p>In general use insertOne and insertMany. This also applies to delete vs deleteMany/deleteOne, update vs updateMany/updateOne, etc.</p>
<h2>Updates</h2>
<p>When you do updates, you&#39;ll have to give a filter as well as what you want to update. Let&#39;s just do an example</p>
<pre><code class="hljs language-javascript">db.<span class="hljs-property">pets</span>.<span class="hljs-title function_">updateOne</span>(
  { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;dog&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Luna&quot;</span>, <span class="hljs-attr">breed</span>: <span class="hljs-string">&quot;Havanese&quot;</span> },
  { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">owner</span>: <span class="hljs-string">&quot;Brian Holt&quot;</span> } }
);
</code></pre><p>The first object is the query. This is the same sort of query you&#39;d use in a <code>.find()</code>. The second is your update object. Here you have a few options with the various update operators. Let&#39;s try another one. Let&#39;s say today is <strong>every dog&#39;s</strong> birthday. How could we increase all of their ages with one update?</p>
<pre><code class="hljs language-javascript">db.<span class="hljs-property">pets</span>.<span class="hljs-title function_">updateMany</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;dog&quot;</span> }, { <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">1</span> } });
</code></pre><p>This will increase the age of all dogs by 1. There are many more sorts of updates but you can take a look at the docs. <a href="https://docs.mongodb.com/manual/reference/operator/update/#id1">Here are the available update operators</a>.</p>
<p>Also worth noting there is an extra parameter you can updateOne and updateMany with additional options. We&#39;re about to talk about one of them in the next section, upsert.</p>
<p>Also do note there is a replaceOne as well. This works just like updateOne but it will delete any fields you omit in your update document that exist already in the doc.</p>
<h2>upsert</h2>
<p>MongoDB does have a concept of &quot;upserting&quot;. This is a portmanteau of the words update and insert and means &quot;insert a new document with these things if you don&#39;t find one that exists with that.&quot; Like maybe you want to create a new user with an email address if you haven&#39;t already, and if it does exist you want to update it with new information.</p>
<p>Let&#39;s see how to do that. Let&#39;s say you want to want to find a dog named &quot;Sudo&quot; and update its owner to &quot;Sarah Drasner&quot; if it exists (it doesn&#39;t in our case) and create a new record with that if there isn&#39;t one.</p>
<pre><code class="hljs language-javascript">db.<span class="hljs-property">pets</span>.<span class="hljs-title function_">updateOne</span>(
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;dog&quot;</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Sudo&quot;</span>,
    <span class="hljs-attr">breed</span>: <span class="hljs-string">&quot;Wheaten&quot;</span>,
  },
  {
    <span class="hljs-attr">$set</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;dog&quot;</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Sudo&quot;</span>,
      <span class="hljs-attr">breed</span>: <span class="hljs-string">&quot;Wheaten&quot;</span>,
      <span class="hljs-attr">age</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">index</span>: <span class="hljs-number">10000</span>,
      <span class="hljs-attr">owner</span>: <span class="hljs-string">&quot;Sarah Drasner&quot;</span>,
    },
  },
  {
    <span class="hljs-attr">upsert</span>: <span class="hljs-literal">true</span>,
  }
);
</code></pre><p>We&#39;re playing this a bit fast and lazy. We should really make sure that we&#39;re querying for a unique object based on some sort of a unique key (we&#39;ll get into that next.) But yes, make sure you&#39;re providing a whole document with an upsert, otherwise on the insert side of upsert you&#39;ll get incomplete documents.</p>
<h2>Deletes</h2>
<p>Deletes work almost identically to finds except instead of returning documents it deletes them. Both <code>deleteOne</code> and <code>deleteMany</code> exist (as does <code>delete</code> which is discouraged.) Let&#39;s say you wanted to delete all Havanese reptiles because that doesn&#39;t make sense.</p>
<pre><code class="hljs language-javascript">db.<span class="hljs-property">pets</span>.<span class="hljs-title function_">deleteMany</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;reptile&quot;</span>, <span class="hljs-attr">breed</span>: <span class="hljs-string">&quot;Havanese&quot;</span> });
</code></pre><h2>findAnd*</h2>
<p>Occasionally you need to find a document <em>and</em> update/delete/replace it at the same time. Instead of having to do two queries and thus have a race-condition of something modifying your document in the interim there are three commands that will allow you to do just that, findOneAndUpdate,
findOneAndReplace, and findOneAndDelete. These work basically identically to updateOne, replaceOne, and deleteOne, they just return it at thend.</p>
<h2>bulkWrite</h2>
<p>Particularly when you&#39;re writing code, sometimes you need to run a series of queries all at once. That&#39;s probably going to be several inserts or maybe a few updates and deletes. Instead of doing a query, waiting, then serially doing the next one, etc. you can do what&#39;s called a bulkWrite. bulkWrite allows you to queue up an array of queries and it will execute those queries in the order that you provide them to MongoDB. It&#39;s possible but weird to do in the mongo CLI shell so we&#39;ll get into it once we&#39;re doing code. Suffice to say, it&#39;s just what we&#39;ve been doing but instead of one query object, you provide an array of those same query objects.</p>
</div><div class="lesson-links"><a class="prev" href="/lessons/nosql/querying-mongodb">← Previous</a><a class="next" href="/lessons/nosql/indexes-in-mongodb">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Brian shows you how to update and delete the documents that have been inserted into the database."},"html":"\u003ch2\u003einsert, insertOne, and insertMany\u003c/h2\u003e\n\u003cp\u003eYou already encountered insert at the beginning of this section but I just wanted to disambiguate insertOne and insertMany for you. insert essentially does the job of both insertMany and insertOne: if you give it an array it will insert many and if you give it an object it will insert one. The insertOne and insertMany methods are nice because if you accidentally give it the wrong thing (like giving it an object when you meant to give it an array) it will cause an error and make you fix it. With insert, you have a higher chance of it doing the wrong thing.\u003c/p\u003e\n\u003cp\u003eIn general use insertOne and insertMany. This also applies to delete vs deleteMany/deleteOne, update vs updateMany/updateOne, etc.\u003c/p\u003e\n\u003ch2\u003eUpdates\u003c/h2\u003e\n\u003cp\u003eWhen you do updates, you\u0026#39;ll have to give a filter as well as what you want to update. Let\u0026#39;s just do an example\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edb.\u003cspan class=\"hljs-property\"\u003epets\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdateOne\u003c/span\u003e(\n  { \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;dog\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Luna\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ebreed\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Havanese\u0026quot;\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003e$set\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eowner\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Brian Holt\u0026quot;\u003c/span\u003e } }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe first object is the query. This is the same sort of query you\u0026#39;d use in a \u003ccode\u003e.find()\u003c/code\u003e. The second is your update object. Here you have a few options with the various update operators. Let\u0026#39;s try another one. Let\u0026#39;s say today is \u003cstrong\u003eevery dog\u0026#39;s\u003c/strong\u003e birthday. How could we increase all of their ages with one update?\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edb.\u003cspan class=\"hljs-property\"\u003epets\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdateMany\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;dog\u0026quot;\u003c/span\u003e }, { \u003cspan class=\"hljs-attr\"\u003e$inc\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eage\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e } });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will increase the age of all dogs by 1. There are many more sorts of updates but you can take a look at the docs. \u003ca href=\"https://docs.mongodb.com/manual/reference/operator/update/#id1\"\u003eHere are the available update operators\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eAlso worth noting there is an extra parameter you can updateOne and updateMany with additional options. We\u0026#39;re about to talk about one of them in the next section, upsert.\u003c/p\u003e\n\u003cp\u003eAlso do note there is a replaceOne as well. This works just like updateOne but it will delete any fields you omit in your update document that exist already in the doc.\u003c/p\u003e\n\u003ch2\u003eupsert\u003c/h2\u003e\n\u003cp\u003eMongoDB does have a concept of \u0026quot;upserting\u0026quot;. This is a portmanteau of the words update and insert and means \u0026quot;insert a new document with these things if you don\u0026#39;t find one that exists with that.\u0026quot; Like maybe you want to create a new user with an email address if you haven\u0026#39;t already, and if it does exist you want to update it with new information.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s see how to do that. Let\u0026#39;s say you want to want to find a dog named \u0026quot;Sudo\u0026quot; and update its owner to \u0026quot;Sarah Drasner\u0026quot; if it exists (it doesn\u0026#39;t in our case) and create a new record with that if there isn\u0026#39;t one.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edb.\u003cspan class=\"hljs-property\"\u003epets\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdateOne\u003c/span\u003e(\n  {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;dog\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Sudo\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ebreed\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Wheaten\u0026quot;\u003c/span\u003e,\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003e$set\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;dog\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Sudo\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003ebreed\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Wheaten\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eage\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eindex\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eowner\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Sarah Drasner\u0026quot;\u003c/span\u003e,\n    },\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003eupsert\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWe\u0026#39;re playing this a bit fast and lazy. We should really make sure that we\u0026#39;re querying for a unique object based on some sort of a unique key (we\u0026#39;ll get into that next.) But yes, make sure you\u0026#39;re providing a whole document with an upsert, otherwise on the insert side of upsert you\u0026#39;ll get incomplete documents.\u003c/p\u003e\n\u003ch2\u003eDeletes\u003c/h2\u003e\n\u003cp\u003eDeletes work almost identically to finds except instead of returning documents it deletes them. Both \u003ccode\u003edeleteOne\u003c/code\u003e and \u003ccode\u003edeleteMany\u003c/code\u003e exist (as does \u003ccode\u003edelete\u003c/code\u003e which is discouraged.) Let\u0026#39;s say you wanted to delete all Havanese reptiles because that doesn\u0026#39;t make sense.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edb.\u003cspan class=\"hljs-property\"\u003epets\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edeleteMany\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;reptile\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ebreed\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Havanese\u0026quot;\u003c/span\u003e });\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003efindAnd*\u003c/h2\u003e\n\u003cp\u003eOccasionally you need to find a document \u003cem\u003eand\u003c/em\u003e update/delete/replace it at the same time. Instead of having to do two queries and thus have a race-condition of something modifying your document in the interim there are three commands that will allow you to do just that, findOneAndUpdate,\nfindOneAndReplace, and findOneAndDelete. These work basically identically to updateOne, replaceOne, and deleteOne, they just return it at thend.\u003c/p\u003e\n\u003ch2\u003ebulkWrite\u003c/h2\u003e\n\u003cp\u003eParticularly when you\u0026#39;re writing code, sometimes you need to run a series of queries all at once. That\u0026#39;s probably going to be several inserts or maybe a few updates and deletes. Instead of doing a query, waiting, then serially doing the next one, etc. you can do what\u0026#39;s called a bulkWrite. bulkWrite allows you to queue up an array of queries and it will execute those queries in the order that you provide them to MongoDB. It\u0026#39;s possible but weird to do in the mongo CLI shell so we\u0026#39;ll get into it once we\u0026#39;re doing code. Suffice to say, it\u0026#39;s just what we\u0026#39;ve been doing but instead of one query object, you provide an array of those same query objects.\u003c/p\u003e\n","markdown":"\n## insert, insertOne, and insertMany\n\nYou already encountered insert at the beginning of this section but I just wanted to disambiguate insertOne and insertMany for you. insert essentially does the job of both insertMany and insertOne: if you give it an array it will insert many and if you give it an object it will insert one. The insertOne and insertMany methods are nice because if you accidentally give it the wrong thing (like giving it an object when you meant to give it an array) it will cause an error and make you fix it. With insert, you have a higher chance of it doing the wrong thing.\n\nIn general use insertOne and insertMany. This also applies to delete vs deleteMany/deleteOne, update vs updateMany/updateOne, etc.\n\n## Updates\n\nWhen you do updates, you'll have to give a filter as well as what you want to update. Let's just do an example\n\n```javascript\ndb.pets.updateOne(\n  { type: \"dog\", name: \"Luna\", breed: \"Havanese\" },\n  { $set: { owner: \"Brian Holt\" } }\n);\n```\n\nThe first object is the query. This is the same sort of query you'd use in a `.find()`. The second is your update object. Here you have a few options with the various update operators. Let's try another one. Let's say today is **every dog's** birthday. How could we increase all of their ages with one update?\n\n```javascript\ndb.pets.updateMany({ type: \"dog\" }, { $inc: { age: 1 } });\n```\n\nThis will increase the age of all dogs by 1. There are many more sorts of updates but you can take a look at the docs. [Here are the available update operators][update].\n\nAlso worth noting there is an extra parameter you can updateOne and updateMany with additional options. We're about to talk about one of them in the next section, upsert.\n\nAlso do note there is a replaceOne as well. This works just like updateOne but it will delete any fields you omit in your update document that exist already in the doc.\n\n## upsert\n\nMongoDB does have a concept of \"upserting\". This is a portmanteau of the words update and insert and means \"insert a new document with these things if you don't find one that exists with that.\" Like maybe you want to create a new user with an email address if you haven't already, and if it does exist you want to update it with new information.\n\nLet's see how to do that. Let's say you want to want to find a dog named \"Sudo\" and update its owner to \"Sarah Drasner\" if it exists (it doesn't in our case) and create a new record with that if there isn't one.\n\n```javascript\ndb.pets.updateOne(\n  {\n    type: \"dog\",\n    name: \"Sudo\",\n    breed: \"Wheaten\",\n  },\n  {\n    $set: {\n      type: \"dog\",\n      name: \"Sudo\",\n      breed: \"Wheaten\",\n      age: 5,\n      index: 10000,\n      owner: \"Sarah Drasner\",\n    },\n  },\n  {\n    upsert: true,\n  }\n);\n```\n\nWe're playing this a bit fast and lazy. We should really make sure that we're querying for a unique object based on some sort of a unique key (we'll get into that next.) But yes, make sure you're providing a whole document with an upsert, otherwise on the insert side of upsert you'll get incomplete documents.\n\n## Deletes\n\nDeletes work almost identically to finds except instead of returning documents it deletes them. Both `deleteOne` and `deleteMany` exist (as does `delete` which is discouraged.) Let's say you wanted to delete all Havanese reptiles because that doesn't make sense.\n\n```javascript\ndb.pets.deleteMany({ type: \"reptile\", breed: \"Havanese\" });\n```\n\n## findAnd\\*\n\nOccasionally you need to find a document _and_ update/delete/replace it at the same time. Instead of having to do two queries and thus have a race-condition of something modifying your document in the interim there are three commands that will allow you to do just that, findOneAndUpdate,\nfindOneAndReplace, and findOneAndDelete. These work basically identically to updateOne, replaceOne, and deleteOne, they just return it at thend.\n\n## bulkWrite\n\nParticularly when you're writing code, sometimes you need to run a series of queries all at once. That's probably going to be several inserts or maybe a few updates and deletes. Instead of doing a query, waiting, then serially doing the next one, etc. you can do what's called a bulkWrite. bulkWrite allows you to queue up an array of queries and it will execute those queries in the order that you provide them to MongoDB. It's possible but weird to do in the mongo CLI shell so we'll get into it once we're doing code. Suffice to say, it's just what we've been doing but instead of one query object, you provide an array of those same query objects.\n\n[update]: https://docs.mongodb.com/manual/reference/operator/update/#id1\n","slug":"updating-mongodb","title":"Updating Mongodb","section":"Nosql","icon":"info-circle","filePath":"/home/runner/work/complete-intro-to-databases-v2/complete-intro-to-databases-v2/lessons/02-nosql/D-updating-mongodb.md","nextSlug":"/lessons/nosql/indexes-in-mongodb","prevSlug":"/lessons/nosql/querying-mongodb"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"nosql","slug":"updating-mongodb"},"buildId":"Ogv8p-BwCHRQ1PzRpAU9u","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>