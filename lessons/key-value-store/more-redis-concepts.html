<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">More Redis Concepts – Complete Intro to Databases v2</title><meta name="description" content="This course only covers some of Redis&#x27;s core capabilties but there a few more use cases a developer should know about Redis." data-next-head=""/><meta name="keywords" content="postgres,sql,redis,mongodb,neo4j,database,data,agents" data-next-head=""/><meta name="og:description" content="This course only covers some of Redis&#x27;s core capabilties but there a few more use cases a developer should know about Redis." data-next-head=""/><meta name="og:title" content="More Redis Concepts – Complete Intro to Databases v2" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/chunks/3802a39ca373f962.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/3802a39ca373f962.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/dbe15a90055bd265.js" defer=""></script><script src="/_next/static/chunks/49c75c2ed6206f46.js" defer=""></script><script src="/_next/static/chunks/da0ff8adaa6cce90.js" defer=""></script><script src="/_next/static/chunks/turbopack-342361b32f83e6b6.js" defer=""></script><script src="/_next/static/chunks/f189af6b04c7fd39.js" defer=""></script><script src="/_next/static/chunks/turbopack-8b35dea75ba6f85c.js" defer=""></script><script src="/_next/static/Ogv8p-BwCHRQ1PzRpAU9u/_ssgManifest.js" defer=""></script><script src="/_next/static/Ogv8p-BwCHRQ1PzRpAU9u/_buildManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><div id="__next"><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet"/><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Databases v2</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/databases-v2/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Redis has a pretty large surface area of capabilties and power that you should be aware of. These are going to be for advance to very-advance use cases of Redis (as in I have never shipped anything with these in them.)</p>
<h2>EVAL and Lua</h2>
<p>Redis has a built in interpreter for Lua which is a fairly simple scripting language. If you need to do a lot of things all at once or for whatever reason need a bit more logic than a simple command that the built-in Redis commands can handle, this is an option.</p>
<p>I&#39;ll say once you&#39;re in the territory of &quot;I need Redis to evaluate Lua for me&quot;, you may want to be asking some questions about what you&#39;re doing.</p>
<p>Let&#39;s run one for fun, try this one</p>
<pre><code class="hljs language-redis">EVAL &quot;for i = 0,9,1 do redis.call(&#x27;SET&#x27;, &#x27;lua_key_&#x27; .. i, i * 5) end&quot; 0
</code></pre><p><code>EVAL</code> allows us to pass some Lua to Redis. In this case we&#39;re doing a loop and setting ten keys in Redis, <code>lua_key_0</code> through <code>lua_key_9</code>. Don&#39;t worry too much about learning Lua. It&#39;s meant to be a very straightforward language to pick up when you need to.</p>
<p>The 0 at the end represents we&#39;re not giving any of the keys that Redis is meant to operating on to Redis to know in advance. Redis wants to know the key names in advance so that if it&#39;s in Redis Cluster mode (aka sharded) it can know where to send these queries. If we don&#39;t give it those keys in advance it makes this incompatible with Redis Cluster. But we&#39;re not in Cluster mode so it&#39;s fine.</p>
<p>Let&#39;s see a bit more complicated.</p>
<pre><code class="hljs language-redis">SET lua_key_name cool_stuff_
EVAL &quot;for i = 0,9,1 do redis.call(&#x27;SET&#x27;, redis.call(&#x27;get&#x27;, KEYS[1]) .. i, i * ARGV[1]) end&quot; 1 lua_key_name 100
</code></pre><p>Here we&#39;re referencing the key we&#39;re passing (so we&#39;re still not fully Cluster compatible since we&#39;re making up keys on the fly) and an argument via the <code>KEYS</code> and <code>ARGV</code> arrays. Keep in mind Lua arrays start at 1, not 0. Same idea at then end though!</p>
<p>There&#39;s also the ability to load whole scripts into Redis externally so you can track the scripts separately and then SHA check them. Feel free to look into that yourself.</p>
<h2>Pub/Sub</h2>
<p>In several capacities, Redis can do publish / subscribe messaging. You can subscribe to a namespace of keys and then whenver those keys update, you can receive a notification to all listening clients. Very useful for real time notifications where you want your code to react to changes instead of some sort of polling strategy. <a href="https://redis.io/topics/notifications">See here</a> for more details.</p>
<h2>Transactions</h2>
<p>On some occasions you&#39;ll want some sort of all-or-nothing sort of behavior from Redis but you don&#39;t have the ability to send all those commands at once. Like maybe you need to set multiple keys, delete others, and increments yet different ones all at the same time, and you don&#39;t anything happening in the middle of it. This is called a <em>transaction</em>. With Redis you can be guaranteed that either all of the commands in a transaction will be run, or none will, and nothing <em>else</em> will happen in the middle of those commands. In this sense these transactions are <em>atomic</em> or cannot be broken up.</p>
<p>You&#39;ll used the <code>MULTI</code>, <code>EXEC</code>, <code>DISCARD</code>, and <code>WATCH</code> commands to execute transactions in Redis. <a href="https://redis.io/topics/transactions">See here</a> to read more.</p>
<h2>LRU</h2>
<p>Some times you just want Redis to act as a simple cache (like Memcached) where you can just write an infinite number of things to Redis and it&#39;ll just keep evicting old stuff from memory like a capped collection in MongoDB.</p>
<p>Redis has this capability through a feature called LRU or <strong>l</strong>east <strong>r</strong>ecently <strong>u</strong>sed where Redis will kick out the least recently used thing in its store to make way for new things.</p>
<p>Imagine you have a service that serves users&#39; profile pictures that gets hit a lot (maybe like Gravatar.) You have all these in a database somewhere but you want to serve most of your traffic from Redis only some from your other database. You could use an LRU cache for this. Let&#39;s say you have 100 million users. You may not want to keep all those in Redis all at once.</p>
<p>The first thing you would do is set how big you want Redis to get. 100MB, 1GB, 10GB, whatever you have space for. Then in your code you first check to see if the request URL is in the cache. If it is, serve it, if it&#39;s not, find in it in the other database, write it to Redis, and serve it to the user. Then Redis, once it reached its space limit, when you wrote to it would evict the least recently used key. The idea is that you will keep the most used keys easily since those users will be using them a lot and users who rarely use it will just have to hit the database and therefore you&#39;ll maximize your cache hits!</p>
<p>What I just described is exactly how Memcached works and if that&#39;s <em>all</em> you need (and don&#39;t mind if you have to rewarm (aka repopulate) that cache again if Redis crashes) then I&#39;d suggest Memcached because it&#39;s so fast. However Redis has many ways of doing key eviction and I&#39;ll just leave this here for you to peruse later. <a href="https://redis.io/topics/lru-cache">See here</a>.</p>
</div><div class="lesson-links"><a class="prev" href="/lessons/key-value-store/redis-data-types">← Previous</a><a class="next" href="/lessons/key-value-store/nodejs-app-with-redis">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"This course only covers some of Redis's core capabilties but there a few more use cases a developer should know about Redis."},"html":"\u003cp\u003eRedis has a pretty large surface area of capabilties and power that you should be aware of. These are going to be for advance to very-advance use cases of Redis (as in I have never shipped anything with these in them.)\u003c/p\u003e\n\u003ch2\u003eEVAL and Lua\u003c/h2\u003e\n\u003cp\u003eRedis has a built in interpreter for Lua which is a fairly simple scripting language. If you need to do a lot of things all at once or for whatever reason need a bit more logic than a simple command that the built-in Redis commands can handle, this is an option.\u003c/p\u003e\n\u003cp\u003eI\u0026#39;ll say once you\u0026#39;re in the territory of \u0026quot;I need Redis to evaluate Lua for me\u0026quot;, you may want to be asking some questions about what you\u0026#39;re doing.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s run one for fun, try this one\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-redis\"\u003eEVAL \u0026quot;for i = 0,9,1 do redis.call(\u0026#x27;SET\u0026#x27;, \u0026#x27;lua_key_\u0026#x27; .. i, i * 5) end\u0026quot; 0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eEVAL\u003c/code\u003e allows us to pass some Lua to Redis. In this case we\u0026#39;re doing a loop and setting ten keys in Redis, \u003ccode\u003elua_key_0\u003c/code\u003e through \u003ccode\u003elua_key_9\u003c/code\u003e. Don\u0026#39;t worry too much about learning Lua. It\u0026#39;s meant to be a very straightforward language to pick up when you need to.\u003c/p\u003e\n\u003cp\u003eThe 0 at the end represents we\u0026#39;re not giving any of the keys that Redis is meant to operating on to Redis to know in advance. Redis wants to know the key names in advance so that if it\u0026#39;s in Redis Cluster mode (aka sharded) it can know where to send these queries. If we don\u0026#39;t give it those keys in advance it makes this incompatible with Redis Cluster. But we\u0026#39;re not in Cluster mode so it\u0026#39;s fine.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s see a bit more complicated.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-redis\"\u003eSET lua_key_name cool_stuff_\nEVAL \u0026quot;for i = 0,9,1 do redis.call(\u0026#x27;SET\u0026#x27;, redis.call(\u0026#x27;get\u0026#x27;, KEYS[1]) .. i, i * ARGV[1]) end\u0026quot; 1 lua_key_name 100\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eHere we\u0026#39;re referencing the key we\u0026#39;re passing (so we\u0026#39;re still not fully Cluster compatible since we\u0026#39;re making up keys on the fly) and an argument via the \u003ccode\u003eKEYS\u003c/code\u003e and \u003ccode\u003eARGV\u003c/code\u003e arrays. Keep in mind Lua arrays start at 1, not 0. Same idea at then end though!\u003c/p\u003e\n\u003cp\u003eThere\u0026#39;s also the ability to load whole scripts into Redis externally so you can track the scripts separately and then SHA check them. Feel free to look into that yourself.\u003c/p\u003e\n\u003ch2\u003ePub/Sub\u003c/h2\u003e\n\u003cp\u003eIn several capacities, Redis can do publish / subscribe messaging. You can subscribe to a namespace of keys and then whenver those keys update, you can receive a notification to all listening clients. Very useful for real time notifications where you want your code to react to changes instead of some sort of polling strategy. \u003ca href=\"https://redis.io/topics/notifications\"\u003eSee here\u003c/a\u003e for more details.\u003c/p\u003e\n\u003ch2\u003eTransactions\u003c/h2\u003e\n\u003cp\u003eOn some occasions you\u0026#39;ll want some sort of all-or-nothing sort of behavior from Redis but you don\u0026#39;t have the ability to send all those commands at once. Like maybe you need to set multiple keys, delete others, and increments yet different ones all at the same time, and you don\u0026#39;t anything happening in the middle of it. This is called a \u003cem\u003etransaction\u003c/em\u003e. With Redis you can be guaranteed that either all of the commands in a transaction will be run, or none will, and nothing \u003cem\u003eelse\u003c/em\u003e will happen in the middle of those commands. In this sense these transactions are \u003cem\u003eatomic\u003c/em\u003e or cannot be broken up.\u003c/p\u003e\n\u003cp\u003eYou\u0026#39;ll used the \u003ccode\u003eMULTI\u003c/code\u003e, \u003ccode\u003eEXEC\u003c/code\u003e, \u003ccode\u003eDISCARD\u003c/code\u003e, and \u003ccode\u003eWATCH\u003c/code\u003e commands to execute transactions in Redis. \u003ca href=\"https://redis.io/topics/transactions\"\u003eSee here\u003c/a\u003e to read more.\u003c/p\u003e\n\u003ch2\u003eLRU\u003c/h2\u003e\n\u003cp\u003eSome times you just want Redis to act as a simple cache (like Memcached) where you can just write an infinite number of things to Redis and it\u0026#39;ll just keep evicting old stuff from memory like a capped collection in MongoDB.\u003c/p\u003e\n\u003cp\u003eRedis has this capability through a feature called LRU or \u003cstrong\u003el\u003c/strong\u003eeast \u003cstrong\u003er\u003c/strong\u003eecently \u003cstrong\u003eu\u003c/strong\u003esed where Redis will kick out the least recently used thing in its store to make way for new things.\u003c/p\u003e\n\u003cp\u003eImagine you have a service that serves users\u0026#39; profile pictures that gets hit a lot (maybe like Gravatar.) You have all these in a database somewhere but you want to serve most of your traffic from Redis only some from your other database. You could use an LRU cache for this. Let\u0026#39;s say you have 100 million users. You may not want to keep all those in Redis all at once.\u003c/p\u003e\n\u003cp\u003eThe first thing you would do is set how big you want Redis to get. 100MB, 1GB, 10GB, whatever you have space for. Then in your code you first check to see if the request URL is in the cache. If it is, serve it, if it\u0026#39;s not, find in it in the other database, write it to Redis, and serve it to the user. Then Redis, once it reached its space limit, when you wrote to it would evict the least recently used key. The idea is that you will keep the most used keys easily since those users will be using them a lot and users who rarely use it will just have to hit the database and therefore you\u0026#39;ll maximize your cache hits!\u003c/p\u003e\n\u003cp\u003eWhat I just described is exactly how Memcached works and if that\u0026#39;s \u003cem\u003eall\u003c/em\u003e you need (and don\u0026#39;t mind if you have to rewarm (aka repopulate) that cache again if Redis crashes) then I\u0026#39;d suggest Memcached because it\u0026#39;s so fast. However Redis has many ways of doing key eviction and I\u0026#39;ll just leave this here for you to peruse later. \u003ca href=\"https://redis.io/topics/lru-cache\"\u003eSee here\u003c/a\u003e.\u003c/p\u003e\n","markdown":"\nRedis has a pretty large surface area of capabilties and power that you should be aware of. These are going to be for advance to very-advance use cases of Redis (as in I have never shipped anything with these in them.)\n\n## EVAL and Lua\n\nRedis has a built in interpreter for Lua which is a fairly simple scripting language. If you need to do a lot of things all at once or for whatever reason need a bit more logic than a simple command that the built-in Redis commands can handle, this is an option.\n\nI'll say once you're in the territory of \"I need Redis to evaluate Lua for me\", you may want to be asking some questions about what you're doing.\n\nLet's run one for fun, try this one\n\n```redis\nEVAL \"for i = 0,9,1 do redis.call('SET', 'lua_key_' .. i, i * 5) end\" 0\n```\n\n`EVAL` allows us to pass some Lua to Redis. In this case we're doing a loop and setting ten keys in Redis, `lua_key_0` through `lua_key_9`. Don't worry too much about learning Lua. It's meant to be a very straightforward language to pick up when you need to.\n\nThe 0 at the end represents we're not giving any of the keys that Redis is meant to operating on to Redis to know in advance. Redis wants to know the key names in advance so that if it's in Redis Cluster mode (aka sharded) it can know where to send these queries. If we don't give it those keys in advance it makes this incompatible with Redis Cluster. But we're not in Cluster mode so it's fine.\n\nLet's see a bit more complicated.\n\n```redis\nSET lua_key_name cool_stuff_\nEVAL \"for i = 0,9,1 do redis.call('SET', redis.call('get', KEYS[1]) .. i, i * ARGV[1]) end\" 1 lua_key_name 100\n```\n\nHere we're referencing the key we're passing (so we're still not fully Cluster compatible since we're making up keys on the fly) and an argument via the `KEYS` and `ARGV` arrays. Keep in mind Lua arrays start at 1, not 0. Same idea at then end though!\n\nThere's also the ability to load whole scripts into Redis externally so you can track the scripts separately and then SHA check them. Feel free to look into that yourself.\n\n## Pub/Sub\n\nIn several capacities, Redis can do publish / subscribe messaging. You can subscribe to a namespace of keys and then whenver those keys update, you can receive a notification to all listening clients. Very useful for real time notifications where you want your code to react to changes instead of some sort of polling strategy. [See here][pubsub] for more details.\n\n## Transactions\n\nOn some occasions you'll want some sort of all-or-nothing sort of behavior from Redis but you don't have the ability to send all those commands at once. Like maybe you need to set multiple keys, delete others, and increments yet different ones all at the same time, and you don't anything happening in the middle of it. This is called a _transaction_. With Redis you can be guaranteed that either all of the commands in a transaction will be run, or none will, and nothing _else_ will happen in the middle of those commands. In this sense these transactions are _atomic_ or cannot be broken up.\n\nYou'll used the `MULTI`, `EXEC`, `DISCARD`, and `WATCH` commands to execute transactions in Redis. [See here][transactions] to read more.\n\n## LRU\n\nSome times you just want Redis to act as a simple cache (like Memcached) where you can just write an infinite number of things to Redis and it'll just keep evicting old stuff from memory like a capped collection in MongoDB.\n\nRedis has this capability through a feature called LRU or **l**east **r**ecently **u**sed where Redis will kick out the least recently used thing in its store to make way for new things.\n\nImagine you have a service that serves users' profile pictures that gets hit a lot (maybe like Gravatar.) You have all these in a database somewhere but you want to serve most of your traffic from Redis only some from your other database. You could use an LRU cache for this. Let's say you have 100 million users. You may not want to keep all those in Redis all at once.\n\nThe first thing you would do is set how big you want Redis to get. 100MB, 1GB, 10GB, whatever you have space for. Then in your code you first check to see if the request URL is in the cache. If it is, serve it, if it's not, find in it in the other database, write it to Redis, and serve it to the user. Then Redis, once it reached its space limit, when you wrote to it would evict the least recently used key. The idea is that you will keep the most used keys easily since those users will be using them a lot and users who rarely use it will just have to hit the database and therefore you'll maximize your cache hits!\n\nWhat I just described is exactly how Memcached works and if that's _all_ you need (and don't mind if you have to rewarm (aka repopulate) that cache again if Redis crashes) then I'd suggest Memcached because it's so fast. However Redis has many ways of doing key eviction and I'll just leave this here for you to peruse later. [See here][lru].\n\n[pubsub]: https://redis.io/topics/notifications\n[transactions]: https://redis.io/topics/transactions\n[lru]: https://redis.io/topics/lru-cache\n","slug":"more-redis-concepts","title":"More Redis Concepts","section":"Key Value Store","icon":"info-circle","filePath":"/home/runner/work/complete-intro-to-databases-v2/complete-intro-to-databases-v2/lessons/05-key-value-store/E-more-redis-concepts.md","nextSlug":"/lessons/key-value-store/nodejs-app-with-redis","prevSlug":"/lessons/key-value-store/redis-data-types"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"key-value-store","slug":"more-redis-concepts"},"buildId":"Ogv8p-BwCHRQ1PzRpAU9u","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>